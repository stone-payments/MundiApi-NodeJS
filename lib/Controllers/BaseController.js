/**
 * MundiAPILib
 *
 * This file was automatically generated by APIMATIC v2.0 ( https://apimatic.io )
 */

'use strict';

const _modelFactory = require('../ModelFactory');
const _objectMapper = require('../ObjectMapper');

const _objectMapperInstance = new _objectMapper();

class BaseController {
    /**
     * Get ObjectMapper instance
     * @return {ObjectMapper} Shared instance
     */
    static getObjectMapper() {
        return _objectMapperInstance;
    }

    /**
     * Global error handling
     * @param   {HttpContext}   _context   HttpContext containing request and response objects
     * @callback    Callback function which returns error, response, context
     */
    static validateResponse(_context) {
        const errorObj = {
            errorMessage: '',
            errorCode: '',
            errorResponse: _context.response.body,
        };
        const returnObj = {
            error: errorObj,
            response: null,
            context: _context,
        };

        let response;
        try {
            response = JSON.parse(_context.response.body);
        } catch (ex) {
            response = JSON.parse(JSON.stringify(_context.response.body));
        }


        if (_context.response.statusCode === 400) {
            returnObj.error.errorMessage = 'Invalid request';
            returnObj.error.errorCode = 400;
            let mappedObject;
            if (response === null || response === undefined) {
                mappedObject = _modelFactory.getInstance('ErrorException');
            } else {
                mappedObject = this.getObjectMapper().mapObject(response, 'ErrorException');
            }
            mappedObject.reason = 'Invalid request';
            mappedObject.context = _context;
            returnObj.error.errorResponse = mappedObject;
        } else if (_context.response.statusCode === 401) {
            returnObj.error.errorMessage = 'Invalid API key';
            returnObj.error.errorCode = 401;
            let mappedObject;
            if (response === null || response === undefined) {
                mappedObject = _modelFactory.getInstance('ErrorException');
            } else {
                mappedObject = this.getObjectMapper().mapObject(response, 'ErrorException');
            }
            mappedObject.reason = 'Invalid API key';
            mappedObject.context = _context;
            returnObj.error.errorResponse = mappedObject;
        } else if (_context.response.statusCode === 404) {
            returnObj.error.errorMessage = 'An informed resource was not found';
            returnObj.error.errorCode = 404;
            let mappedObject;
            if (response === null || response === undefined) {
                mappedObject = _modelFactory.getInstance('ErrorException');
            } else {
                mappedObject = this.getObjectMapper().mapObject(response, 'ErrorException');
            }
            mappedObject.reason = 'An informed resource was not found';
            mappedObject.context = _context;
            returnObj.error.errorResponse = mappedObject;
            returnObj.response = _context.body.response;
        } else if (_context.response.statusCode === 412) {
            returnObj.error.errorMessage = 'Business validation error';
            returnObj.error.errorCode = 412;
            let mappedObject;
            if (response === null || response === undefined) {
                mappedObject = _modelFactory.getInstance('ErrorException');
            } else {
                mappedObject = this.getObjectMapper().mapObject(response, 'ErrorException');
            }
            mappedObject.reason = 'Business validation error';
            mappedObject.context = _context;
            returnObj.error.errorResponse = mappedObject;
        } else if (_context.response.statusCode === 422) {
            returnObj.error.errorMessage = 'Contract validation error';
            returnObj.error.errorCode = 422;
            let mappedObject;
            if (response === null || response === undefined) {
                mappedObject = _modelFactory.getInstance('ErrorException');
            } else {
                mappedObject = this.getObjectMapper().mapObject(response, 'ErrorException');
            }
            mappedObject.reason = 'Contract validation error';
            mappedObject.context = _context;
            returnObj.error.errorResponse = mappedObject;
        } else if (_context.response.statusCode === 500) {
            returnObj.error.errorMessage = 'Internal server error';
            returnObj.error.errorCode = 500;
            let mappedObject;
            if (response === null || response === undefined) {
                mappedObject = _modelFactory.getInstance('ErrorException');
            } else {
                mappedObject = this.getObjectMapper().mapObject(response, 'ErrorException');
            }
            mappedObject.reason = 'Internal server error';
            mappedObject.context = _context;
            returnObj.error.errorResponse = mappedObject;
        } else {
            returnObj.error.errorMessage = 'HTTP Response Not OK';
            returnObj.error.errorCode = _context.response.statusCode;
        }

        return returnObj;
    }
}

module.exports = BaseController;
